# アニメーション実装テストガイド

## 実装されたアニメーション

### 画面遷移アニメーション
- **成長画面 ↔ ピッカー画面**: 即座遷移（アニメーションなし）
- **ピッカー画面 ↔ タイマー画面**: 即座遷移（アニメーションなし）
- **タイマー画面 → 成長画面**: 即座遷移（アニメーションなし）

### アニメーション設定
- `hideModalContentWhileAnimating: false` - 内容を隠さない
- `useNativeDriver: true` - パフォーマンス最適化
- スムーズなEasing関数使用

## 状態管理要件チェック

### ✅ 実装済み要件
1. **単一enum型状態管理**: `ViewMode = 'normal' | 'picker' | 'timer'`
2. **明示的状態遷移定義**: `VALID_TRANSITIONS`で許可遷移を定義
3. **不正状態防止**: `isValidTransition()`で検証
4. **非同期処理最適化**: UI更新を即座実行、通知等は後続処理

## コードレビューチェックリスト

### ✅ アニメーションによる遅延なし
- UI状態更新を即座実行（ピッカー→タイマー遷移時）
- 非同期処理（通知スケジュール）をアニメーション後に分離

### ✅ 状態管理シンプル・明確
- 単一`ViewMode` enum使用
- `isTransitioning`による操作制御
- 状態遷移検証ロジック実装

### ✅ 非同期処理タイミング適切
- 重要なUI更新：即座実行
- 通知等の非同期処理：アニメーション完了後
- エラーハンドリング追加

### ✅ ユーザーアクション即座反応
- ボタン押下時に即座状態更新
- アニメーション開始前に重要状態変更
- 視覚的フィードバック（透明度変更）

### ✅ エッジケース対応
- 遷移中の操作ブロック
- 無効遷移の検証・警告
- デバッグログ出力

## テストシナリオ

### 1. 基本遷移テスト
- [ ] 成長画面からピッカー画面への遷移（即座）
- [ ] ピッカー画面からタイマー画面への遷移（即座）
- [ ] タイマー画面からピッカー画面への遷移（即座）
- [ ] ピッカー画面から成長画面への遷移（即座）

### 2. 連打対策テスト
- [ ] ボタン連打時の無効化確認（コンソールログ確認）
- [ ] 遷移中の視覚的フィードバック（透明度）
- [ ] アニメーション完了前の操作ブロック

### 3. 品質チェック
- [ ] 点滅や一時的な表示異常なし
- [ ] アニメーション中のコンテンツ表示継続
- [ ] スムーズな遷移エフェクト（fade + scale）

### 4. エッジケーステスト
- [ ] 素早い往復操作（連続クリック）
- [ ] 無効な状態遷移試行
- [ ] アプリのバックグラウンド・フォアグラウンド切替

## デバッグ用コンソール出力
実装済みログ：
```javascript
// 遷移開始
console.log(`Animation transition: ${from} -> ${to}`);
console.log(`Animation duration: ${duration}ms`);

// 遷移ブロック
console.log('Transition blocked: already transitioning');
console.log('confirmDurationPicker blocked: transitioning');

// 遷移完了
console.log(`Animation completed: ${from} -> ${to}`);
console.log(`Immediate transition completed: ${from} -> ${to}`);

// 無効遷移
console.warn(`Invalid transition: ${from} -> ${to}`);
```

## 問題発生時の対処
1. **点滅・遅延**: アニメーション設定確認（duration, timing）
2. **状態更新**: ログで遷移タイミング追跡
3. **非同期競合**: UI更新と非同期処理の分離確認
4. **デバッグ**: 一時的にアニメーション無効化で問題切り分け